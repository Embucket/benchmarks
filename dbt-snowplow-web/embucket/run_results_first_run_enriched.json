{
  "metadata": {
    "dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json",
    "dbt_version": "1.9.8",
    "generated_at": "2025-11-02T11:32:47.659042Z",
    "invocation_id": "bdb8751c-4df2-4292-b365-9c0433964b81",
    "env": {}
  },
  "results": [
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:28.762631Z",
          "completed_at": "2025-11-02T11:32:28.777131Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:28.777601Z",
          "completed_at": "2025-11-02T11:32:28.777607Z"
        }
      ],
      "thread_id": "main",
      "execution_time": 0.014976,
      "adapter_response": {},
      "message": "snowplow_web.on-run-start.0 passed",
      "failures": 0,
      "unique_id": "operation.snowplow_web.snowplow_web-on-run-start-0",
      "compiled": true,
      "compiled_code": "\n\n  \n\n",
      "relation_name": null,
      "batch_results": null
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:28.787201Z",
          "completed_at": "2025-11-02T11:32:28.791368Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:28.792023Z",
          "completed_at": "2025-11-02T11:32:29.394128Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 0.6122210025787354,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-4457811ea6ef"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_incremental_manifest",
      "compiled": true,
      "compiled_code": "\n\n\n\n\n\n\n        with prep as (\n        select\n            cast(null as \n    TEXT\n) model,\n            cast('1970-01-01' as timestamp) as last_success\n        )\n\n        select *\n\n        from prep\n        where false\n    ",
      "relation_name": "embucket.public_snowplow_manifest.snowplow_web_incremental_manifest",
      "batch_results": null,
      "actual_row_count": 23
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:28.782787Z",
          "completed_at": "2025-11-02T11:32:28.791750Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:28.806364Z",
          "completed_at": "2025-11-02T11:32:29.395141Z"
        }
      ],
      "thread_id": "Thread-1 (worker)",
      "execution_time": 0.6135637760162354,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-4457811e8c4e"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_base_quarantined_sessions",
      "compiled": true,
      "compiled_code": "\n\n\n\n\n\n\n        with prep as (\n        select\n            \n                cast(null as \n    TEXT\n) session_identifier\n            \n        )\n\n        select *\n\n        from prep\n        where false\n\n    ",
      "relation_name": "embucket.public_snowplow_manifest.snowplow_web_base_quarantined_sessions",
      "batch_results": null,
      "actual_row_count": 0
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:29.398945Z",
          "completed_at": "2025-11-02T11:32:29.865355Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:29.865747Z",
          "completed_at": "2025-11-02T11:32:30.769159Z"
        }
      ],
      "thread_id": "Thread-4 (worker)",
      "execution_time": 1.370906114578247,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-4457810ef985"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_base_new_event_limits",
      "compiled": true,
      "compiled_code": "\n\n\n      select \n        cast('2025-09-01' as timestamp)\n     as lower_limit,\n              least(\n\n    dateadd(\n        day,\n        50,\n        \n        cast('2025-09-01' as timestamp)\n    \n        )\n\n,\n              \n    convert_timezone('UTC', convert_timezone('UTC', current_timestamp()))::timestamp\n) as upper_limit\n    ",
      "relation_name": "embucket.public_scratch.snowplow_web_base_new_event_limits",
      "batch_results": null,
      "actual_row_count": 1
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:30.773487Z",
          "completed_at": "2025-11-02T11:32:31.144168Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:31.144790Z",
          "completed_at": "2025-11-02T11:32:32.194714Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 1.4222307205200195,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780f25b03"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_base_sessions_lifecycle_manifest",
      "compiled": true,
      "compiled_code": "\n\n\n\n\n\n\n\n        with new_events_session_ids_init as (\n            select\n            \n                COALESCE(\n                    e.domain_sessionid,NULL\n                ) as session_identifier,\n                max(\n                    COALESCE(\n                        e.domain_userid,NULL\n                    )\n                ) as user_identifier, -- Edge case 1: Arbitary selection to avoid window function like first_value.\n            \n                min(collector_tstamp) as start_tstamp,\n                max(collector_tstamp) as end_tstamp\n\n            from embucket.atomic.events e\n\n            where\n                dvce_sent_tstamp <= \n\n    dateadd(\n        day,\n        3,\n        dvce_created_tstamp\n        )\n\n -- don't process data that's too late\n                and collector_tstamp >= \n        cast('2025-09-01 00:00:00' as timestamp)\n    \n                and collector_tstamp <= \n        cast('2025-10-21 00:00:00' as timestamp)\n    \n                and true\n                and True --don't reprocess sessions that have already been processed.\n                \n\n            group by 1\n        ), new_events_session_ids as (\n            select *\n            from new_events_session_ids_init e\n            \n                where session_identifier is not null\n                and not exists (select 1 from embucket.public_snowplow_manifest.snowplow_web_base_quarantined_sessions as a where a.session_identifier = e.session_identifier) -- don't continue processing v.long sessions\n\n        )\n        \n\n        , session_lifecycle as (\n\n        select * from new_events_session_ids\n\n        )\n\n        \n\n        select\n        sl.session_identifier,\n        sl.user_identifier,\n        sl.start_tstamp,\n        least(\n\n    dateadd(\n        day,\n        3,\n        sl.start_tstamp\n        )\n\n, sl.end_tstamp) as end_tstamp -- limit session length to max_session_days\n        \n\n        from session_lifecycle sl\n    ",
      "relation_name": "embucket.public_snowplow_manifest.snowplow_web_base_sessions_lifecycle_manifest",
      "batch_results": null,
      "actual_row_count": 10000
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:32.199428Z",
          "completed_at": "2025-11-02T11:32:32.419109Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:32.419603Z",
          "completed_at": "2025-11-02T11:32:33.537947Z"
        }
      ],
      "thread_id": "Thread-3 (worker)",
      "execution_time": 1.339547872543335,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780e81b70"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_base_sessions_this_run",
      "compiled": true,
      "compiled_code": "\n\n\n\n\n\n\n\n\n\n        select\n        s.session_identifier,\n        s.user_identifier,\n        s.start_tstamp,\n        -- end_tstamp used in next step to limit events. When backfilling, set end_tstamp to upper_limit if end_tstamp > upper_limit.\n        -- This ensures we don't accidentally process events after upper_limit\n        case when s.end_tstamp > \n        cast('2025-10-21 00:00:00' as timestamp)\n     then \n        cast('2025-10-21 00:00:00' as timestamp)\n     else s.end_tstamp end as end_tstamp\n\n        from embucket.public_snowplow_manifest.snowplow_web_base_sessions_lifecycle_manifest s\n\n        where\n        -- General window of start_tstamps to limit table scans. Logic complicated by backfills.\n        -- To be within the run, session start_tstamp must be >= lower_limit - max_session_days as we limit end_tstamp in manifest to start_tstamp + max_session_days\n        s.start_tstamp >= \n        cast('2025-08-29 00:00:00' as timestamp)\n    \n        and s.start_tstamp <= \n        cast('2025-10-21 00:00:00' as timestamp)\n    \n        -- Select sessions within window that either; start or finish between lower & upper limit, start and finish outside of lower and upper limits\n        and not (s.start_tstamp > \n        cast('2025-10-21 00:00:00' as timestamp)\n     or s.end_tstamp < \n        cast('2025-09-01 00:00:00' as timestamp)\n    )\n    ",
      "relation_name": "embucket.public_scratch.snowplow_web_base_sessions_this_run",
      "batch_results": null,
      "actual_row_count": 10000
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:33.543086Z",
          "completed_at": "2025-11-02T11:32:33.748346Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:33.748632Z",
          "completed_at": "2025-11-02T11:32:35.565020Z"
        }
      ],
      "thread_id": "Thread-1 (worker)",
      "execution_time": 2.0230019092559814,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780d3d0c4"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_base_events_this_run",
      "compiled": true,
      "compiled_code": "\n\n\n\n\n\nwith base_query as (\n  \n        with identified_events AS (\n            select\n                COALESCE(\n                        e.domain_sessionid,NULL\n                    ) as session_identifier,\n                e.*\n                \n\n            from embucket.atomic.events e\n\n        )\n\n        select\n            a.*,\n            b.user_identifier -- take user_identifier from manifest. This ensures only 1 domain_userid per session.\n\n        from identified_events as a\n        inner join embucket.public_scratch.snowplow_web_base_sessions_this_run as b\n        on a.session_identifier = b.session_identifier\n\n        where a.collector_tstamp <= \n\n    dateadd(\n        day,\n        3,\n        b.start_tstamp\n        )\n\n\n        and a.dvce_sent_tstamp <= \n\n    dateadd(\n        day,\n        3,\n        a.dvce_created_tstamp\n        )\n\n\n        and a.collector_tstamp >= \n        cast('2025-09-14 00:00:26.021000' as timestamp)\n    \n        and a.collector_tstamp <= \n        cast('2025-09-14 23:59:47.336000' as timestamp)\n    \n        and a.collector_tstamp >= b.start_tstamp -- deal with late loading events\n\n        \n\n        and true\n\n        qualify row_number() over (partition by a.event_id order by a.collector_tstamp, a.dvce_created_tstamp) = 1\n    \n)\n\nselect\n  a.contexts_com_snowplowanalytics_snowplow_web_page_1[0]:id::varchar as page_view_id,\n  a.session_identifier as domain_sessionid,\n  a.domain_sessionid as original_domain_sessionid,\n  a.user_identifier as domain_userid,\n  a.domain_userid as original_domain_userid,\n  a.* exclude(contexts_com_snowplowanalytics_snowplow_web_page_1, domain_sessionid, domain_userid)\n\nfrom base_query a",
      "relation_name": "embucket.public_scratch.snowplow_web_base_events_this_run",
      "batch_results": null,
      "actual_row_count": 10000
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:35.584808Z",
          "completed_at": "2025-11-02T11:32:35.615013Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:35.616995Z",
          "completed_at": "2025-11-02T11:32:36.544632Z"
        }
      ],
      "thread_id": "Thread-3 (worker)",
      "execution_time": 0.9706308841705322,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780b710e8"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_pv_engaged_time",
      "compiled": true,
      "compiled_code": "\n\n\n\nselect\n  ev.page_view_id,\n  \n  ev.domain_sessionid,\n  \n  max(ev.derived_tstamp) as end_tstamp,\n\n  -- aggregate pings:\n    -- divides epoch tstamps by snowplow__heartbeat to get distinct intervals\n    -- floor rounds to nearest integer - duplicates all evaluate to the same number\n    -- count(distinct) counts duplicates only once\n    -- adding snowplow__min_visit_length accounts for the page view event itself.\n\n  10 * (count(distinct(floor(date_part('epoch_seconds', ev.dvce_created_tstamp)/10))) - 1) + 5 as engaged_time_in_s\n\nfrom embucket.public_scratch.snowplow_web_base_events_this_run as ev\n\nwhere ev.event_name = 'page_ping'\nand ev.page_view_id is not null\n\ngroup by 1 , 2 ",
      "relation_name": "embucket.public_scratch.snowplow_web_pv_engaged_time",
      "batch_results": null,
      "actual_row_count": 1385
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:35.576080Z",
          "completed_at": "2025-11-02T11:32:35.614754Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:35.615345Z",
          "completed_at": "2025-11-02T11:32:36.548135Z"
        }
      ],
      "thread_id": "Thread-4 (worker)",
      "execution_time": 0.9764759540557861,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780b6db78"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_consent_events_this_run",
      "compiled": true,
      "compiled_code": "\n\n\n\nwith prep as (\n\n  select\n    e.event_id,\n    e.domain_userid,\n    e.original_domain_userid,\n    e.user_id,\n    e.geo_country,\n    e.page_view_id,\n    e.domain_sessionid,\n    e.original_domain_sessionid,\n    e.derived_tstamp,\n    e.load_tstamp,\n    e.event_name,\n    e.unstruct_event_com_snowplowanalytics_snowplow_consent_preferences_1:eventType::varchar as event_type,\n    e.unstruct_event_com_snowplowanalytics_snowplow_consent_preferences_1:basisForProcessing::varchar as basis_for_processing,\n    e.unstruct_event_com_snowplowanalytics_snowplow_consent_preferences_1:consentUrl::varchar as consent_url,\n    e.unstruct_event_com_snowplowanalytics_snowplow_consent_preferences_1:consentVersion::varchar as consent_version,\n    e.unstruct_event_com_snowplowanalytics_snowplow_consent_preferences_1:consentScopes::array as consent_scopes,\n    e.unstruct_event_com_snowplowanalytics_snowplow_consent_preferences_1:domainsApplied::array as domains_applied,\n    e.unstruct_event_com_snowplowanalytics_snowplow_consent_preferences_1:gdprApplies::boolean as gdpr_applies,\n    e.unstruct_event_com_snowplowanalytics_snowplow_cmp_visible_1:elapsedTime::float as cmp_load_time\n\n  from embucket.public_scratch.snowplow_web_base_events_this_run as e\n\n  where event_name in ('cmp_visible', 'consent_preferences')\n\n  and True --returns false if run doesn't contain new events.\n\n  \n      \n  and not rlike(lower(useragent), '.*(bot|crawl|slurp|spider|archiv|spinn|sniff|seo|audit|survey|pingdom|worm|capture|(browser|screen)shots|analyz|index|thumb|check|facebook|pingdombot|phantomjs|yandexbot|twitterbot|a_archiver|facebookexternalhit|bingbot|bingpreview|googlebot|baiduspider|360(spider|user-agent)|semalt).*')\n\n  \n\n)\n\nselect\n  p.event_id,\n  p.domain_userid,\n  p.original_domain_userid,\n  p.user_id,\n  p.geo_country,\n  p.page_view_id,\n  p.domain_sessionid,\n  p.original_domain_sessionid,\n  p.derived_tstamp,\n  p.load_tstamp,\n  p.event_name,\n  p.event_type,\n  p.basis_for_processing,\n  p.consent_url,\n  p.consent_version,\n  \n    array_to_string(p.consent_scopes,', ')\n as consent_scopes,\n  \n    array_to_string(p.domains_applied,', ')\n as domains_applied,\n  coalesce(p.gdpr_applies, false) as gdpr_applies,\n  p.cmp_load_time\n\nfrom prep p",
      "relation_name": "embucket.public_scratch.snowplow_web_consent_events_this_run",
      "batch_results": null,
      "actual_row_count": 2846
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:35.590385Z",
          "completed_at": "2025-11-02T11:32:35.612793Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:35.613013Z",
          "completed_at": "2025-11-02T11:32:36.550903Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 0.9760019779205322,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780b708f4"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_pv_scroll_depth",
      "compiled": true,
      "compiled_code": "\n\n\n\nwith prep as (\n  select\n    ev.page_view_id,\n    \n    ev.domain_sessionid,\n    \n\n    max(ev.doc_width) as doc_width,\n    max(ev.doc_height) as doc_height,\n\n    max(ev.br_viewwidth) as br_viewwidth,\n    max(ev.br_viewheight) as br_viewheight,\n\n    -- coalesce replaces null with 0 (because the page view event does send an offset)\n    -- greatest prevents outliers (negative offsets)\n    -- least also prevents outliers (offsets greater than the docwidth or docheight)\n\n    least(greatest(min(coalesce(ev.pp_xoffset_min, 0)), 0), max(ev.doc_width)) as hmin, -- should be zero\n    least(greatest(max(coalesce(ev.pp_xoffset_max, 0)), 0), max(ev.doc_width)) as hmax,\n\n    least(greatest(min(coalesce(ev.pp_yoffset_min, 0)), 0), max(ev.doc_height)) as vmin, -- should be zero (edge case: not zero because the pv event is missing)\n    least(greatest(max(coalesce(ev.pp_yoffset_max, 0)), 0), max(ev.doc_height)) as vmax\n\n  from embucket.public_scratch.snowplow_web_base_events_this_run as ev\n\n  where ev.event_name in ('page_view', 'page_ping')\n    and ev.page_view_id is not null\n    and ev.doc_height > 0 -- exclude problematic (but rare) edge case\n    and ev.doc_width > 0 -- exclude problematic (but rare) edge case\n\n  group by 1 , 2 \n)\n\nselect\n  page_view_id,\n  \n  domain_sessionid,\n  \n\n  doc_width,\n  doc_height,\n\n  br_viewwidth,\n  br_viewheight,\n\n  hmin,\n  hmax,\n  vmin,\n  vmax,\n\n  cast(round(100*(greatest(hmin, 0)/cast(doc_width as float))) as float) as relative_hmin, -- brackets matter: because hmin is of type int, we need to divide before we multiply by 100 or we risk an overflow\n  cast(round(100*(least(hmax + br_viewwidth, doc_width)/cast(doc_width as float))) as float) as relative_hmax,\n  cast(round(100*(greatest(vmin, 0)/cast(doc_height as float))) as float) as relative_vmin,\n  cast(round(100*(least(vmax + br_viewheight, doc_height)/cast(doc_height as float))) as float) as relative_vmax -- not zero when a user hasn't scrolled because it includes the non-zero viewheight\n\nfrom prep",
      "relation_name": "embucket.public_scratch.snowplow_web_pv_scroll_depth",
      "batch_results": null,
      "actual_row_count": 2825
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:36.560582Z",
          "completed_at": "2025-11-02T11:32:36.579854Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:36.580535Z",
          "completed_at": "2025-11-02T11:32:37.548865Z"
        }
      ],
      "thread_id": "Thread-3 (worker)",
      "execution_time": 0.9914438724517822,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780a7b21b"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_user_mapping",
      "compiled": true,
      "compiled_code": "\n\n\n\n\nselect distinct\n  domain_userid,\n  last_value(user_id) over(\n    partition by domain_userid\n    order by collector_tstamp\n    rows between unbounded preceding and unbounded following\n  ) as user_id,\n  max(collector_tstamp) over (partition by domain_userid) as end_tstamp\n\nfrom embucket.public_scratch.snowplow_web_base_events_this_run\n\nwhere True --returns false if run doesn't contain new events.\nand user_id is not null\nand domain_userid is not null",
      "relation_name": "embucket.public_derived.snowplow_web_user_mapping",
      "batch_results": null,
      "actual_row_count": 10000
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:36.574075Z",
          "completed_at": "2025-11-02T11:32:36.580233Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:36.583192Z",
          "completed_at": "2025-11-02T11:32:37.723284Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 1.1632719039916992,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-4457809e2f78"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_consent_log",
      "compiled": true,
      "compiled_code": "\n\n\n\nselect\n  *\n  \n\nfrom embucket.public_scratch.snowplow_web_consent_events_this_run\n\nwhere True --returns false if run doesn't contain new events.",
      "relation_name": "embucket.public_derived.snowplow_web_consent_log",
      "batch_results": null,
      "actual_row_count": 2846
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:36.568006Z",
          "completed_at": "2025-11-02T11:32:36.586584Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:36.586946Z",
          "completed_at": "2025-11-02T11:32:37.740552Z"
        }
      ],
      "thread_id": "Thread-4 (worker)",
      "execution_time": 1.1813340187072754,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780a78236"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_vital_events_this_run",
      "compiled": true,
      "compiled_code": "\n\n\n\nwith prep as (\n\n  select\n    e.event_id,\n    e.event_name,\n    e.app_id,\n    e.platform,\n    e.domain_userid,\n    e.original_domain_userid,\n    e.user_id,\n    e.page_view_id,\n    e.domain_sessionid,\n    e.original_domain_sessionid,\n    e.collector_tstamp,\n    e.derived_tstamp,\n    e.dvce_created_tstamp,\n    e.load_tstamp,\n    e.geo_country,\n    e.page_url,\n    e.page_title,\n    e.useragent,\n\n    contexts_nl_basjes_yauaa_context_1[0]:deviceClass::VARCHAR as device_class,\n        contexts_nl_basjes_yauaa_context_1[0]:agentClass::VARCHAR as agent_class,\n        contexts_nl_basjes_yauaa_context_1[0]:agentName::VARCHAR as agent_name,\n        contexts_nl_basjes_yauaa_context_1[0]:agentNameVersion::VARCHAR as agent_name_version,\n        contexts_nl_basjes_yauaa_context_1[0]:agentNameVersionMajor::VARCHAR as agent_name_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:agentVersion::VARCHAR as agent_version,\n        contexts_nl_basjes_yauaa_context_1[0]:agentVersionMajor::VARCHAR as agent_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:deviceBrand::VARCHAR as device_brand,\n        contexts_nl_basjes_yauaa_context_1[0]:deviceName::VARCHAR as device_name,\n        contexts_nl_basjes_yauaa_context_1[0]:deviceVersion::VARCHAR as device_version,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineClass::VARCHAR as layout_engine_class,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineName::VARCHAR as layout_engine_name,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineNameVersion::VARCHAR as layout_engine_name_version,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineNameVersionMajor::VARCHAR as layout_engine_name_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineVersion::VARCHAR as layout_engine_version,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineVersionMajor::VARCHAR as layout_engine_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemClass::VARCHAR as operating_system_class,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemName::VARCHAR as operating_system_name,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemNameVersion::VARCHAR as operating_system_name_version,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemVersion::VARCHAR as operating_system_version,\n\n    ceil(e.unstruct_event_com_snowplowanalytics_snowplow_web_vitals_1:lcp::decimal(14,4), 3) /1000 as lcp,\n    ceil(e.unstruct_event_com_snowplowanalytics_snowplow_web_vitals_1:fcp::decimal(14,4), 3) as fcp,\n    ceil(e.unstruct_event_com_snowplowanalytics_snowplow_web_vitals_1:fid::decimal(14,4), 3) as fid,\n    ceil(e.unstruct_event_com_snowplowanalytics_snowplow_web_vitals_1:cls::decimal(14,4), 3) as cls,\n    ceil(e.unstruct_event_com_snowplowanalytics_snowplow_web_vitals_1:inp::decimal(14,4), 3) as inp,\n    ceil(e.unstruct_event_com_snowplowanalytics_snowplow_web_vitals_1:ttfb::decimal(14,4), 3) as ttfb,\n    e.unstruct_event_com_snowplowanalytics_snowplow_web_vitals_1:navigationType::varchar as navigation_type\n\n  from embucket.public_scratch.snowplow_web_base_events_this_run as e\n\n  where True --returns false if run doesn't contain new events.\n\n  and event_name = 'web_vitals'\n\n  and page_view_id is not null\n\n  -- exclude bot traffic\n\n  \n    and not \ne.contexts_com_iab_snowplow_spiders_and_robots_1[0]:spiderOrRobot::boolean\n = True\n  \n\n  \n  and not rlike(lower(useragent), '.*(bot|crawl|slurp|spider|archiv|spinn|sniff|seo|audit|survey|pingdom|worm|capture|(browser|screen)shots|analyz|index|thumb|check|facebook|pingdombot|phantomjs|yandexbot|twitterbot|a_archiver|facebookexternalhit|bingbot|bingpreview|googlebot|baiduspider|360(spider|user-agent)|semalt).*')\n\n\n)\n\nselect\n  event_id,\n  event_name,\n  app_id,\n  platform,\n  domain_userid,\n  original_domain_userid,\n  user_id,\n  page_view_id,\n  domain_sessionid,\n  original_domain_sessionid,\n  collector_tstamp,\n  derived_tstamp,\n  dvce_created_tstamp,\n  load_tstamp,\n  geo_country,\n  page_url,\n  page_title,\n  useragent,\n  lower(device_class) as device_class,\n  agent_class,\n  agent_name,\n  agent_name_version,\n  agent_name_version_major,\n  agent_version,\n  agent_version_major,\n  device_brand,\n  device_name,\n  device_version,\n  layout_engine_class,\n  layout_engine_name,\n  layout_engine_name_version,\n  layout_engine_name_version_major,\n  layout_engine_version,\n  layout_engine_version_major,\n  operating_system_class,\n  operating_system_name,\n  operating_system_name_version,\n  operating_system_version,\n  lcp,\n  fcp,\n  fid,\n  cls,\n  inp,\n  ttfb,\n  navigation_type\n\nfrom prep p",
      "relation_name": "embucket.public_scratch.snowplow_web_vital_events_this_run",
      "batch_results": null,
      "actual_row_count": 1427
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:35.595995Z",
          "completed_at": "2025-11-02T11:32:35.618558Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:35.618874Z",
          "completed_at": "2025-11-02T11:32:38.067234Z"
        }
      ],
      "thread_id": "Thread-1 (worker)",
      "execution_time": 2.4919989109039307,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780b7012b"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_sessions_this_run",
      "compiled": true,
      "compiled_code": "\n\n\n\nwith session_firsts as (\n    select\n        -- app id\n        app_id as app_id,\n\n        platform,\n\n        -- session fields\n        domain_sessionid,\n        original_domain_sessionid,\n        domain_sessionidx,\n\n        \n    convert_timezone('UTC', convert_timezone('UTC', current_timestamp()))::timestamp\n as model_tstamp,\n\n        -- user fields\n        user_id,\n        domain_userid,\n        original_domain_userid,\n        \n            -- updated with mapping as part of post hook on derived sessions table\n            cast(domain_userid as TEXT) as stitched_user_id,\n        \n        network_userid as network_userid,\n\n        -- first page fields\n        page_title as first_page_title,\n        page_url as first_page_url,\n        page_urlscheme as first_page_urlscheme,\n        page_urlhost as first_page_urlhost,\n        page_urlpath as first_page_urlpath,\n        page_urlquery as first_page_urlquery,\n        page_urlfragment as first_page_urlfragment,\n\n        -- referrer fields\n        page_referrer as referrer,\n\n        refr_urlscheme as refr_urlscheme,\n        refr_urlhost as refr_urlhost,\n        refr_urlpath as refr_urlpath,\n        refr_urlquery as refr_urlquery,\n        refr_urlfragment as refr_urlfragment,\n        refr_medium as refr_medium,\n        refr_source as refr_source,\n        refr_term as refr_term,\n\n        -- marketing fields\n        mkt_medium as mkt_medium,\n        mkt_source as mkt_source,\n        mkt_term as mkt_term,\n        mkt_content as mkt_content,\n        mkt_campaign as mkt_campaign,\n        mkt_clickid as mkt_clickid,\n        mkt_network as mkt_network,\n        regexp_substr(page_urlquery, 'utm_source_platform=([^?&#]*)', 1, 1, 'e') as mkt_source_platform,\n        \ncase\n   when lower(trim(mkt_source)) = '(direct)' and lower(trim(mkt_medium)) in ('(not set)', '(none)') then 'Direct'\n   when lower(trim(mkt_medium)) like '%cross-network%' then 'Cross-network'\n   when regexp_like(lower(trim(mkt_medium)), '^(.*cp.*|ppc|retargeting|paid.*)$') then\n      case\n         when upper(source_category) = 'SOURCE_CATEGORY_SHOPPING'\n            or regexp_like(lower(trim(mkt_campaign)), '^(.*(([^a-df-z]|^)shop|shopping).*)$') then 'Paid Shopping'\n         when upper(source_category) = 'SOURCE_CATEGORY_SEARCH' then 'Paid Search'\n         when upper(source_category) = 'SOURCE_CATEGORY_SOCIAL' then 'Paid Social'\n         when upper(source_category) = 'SOURCE_CATEGORY_VIDEO' then 'Paid Video'\n         else 'Paid Other'\n      end\n   when lower(trim(mkt_medium)) in ('display', 'banner', 'expandable', 'intersitial', 'cpm') then 'Display'\n   when upper(source_category) = 'SOURCE_CATEGORY_SHOPPING'\n      or regexp_like(lower(trim(mkt_campaign)), '^(.*(([^a-df-z]|^)shop|shopping).*)$') then 'Organic Shopping'\n   when upper(source_category) = 'SOURCE_CATEGORY_SOCIAL' or lower(trim(mkt_medium)) in ('social', 'social-network', 'sm', 'social network', 'social media') then 'Organic Social'\n   when upper(source_category) = 'SOURCE_CATEGORY_VIDEO'\n      or regexp_like(lower(trim(mkt_medium)), '^(.*video.*)$') then 'Organic Video'\n   when upper(source_category) = 'SOURCE_CATEGORY_SEARCH' or lower(trim(mkt_medium)) = 'organic' then 'Organic Search'\n   when lower(trim(mkt_medium)) in ('referral', 'app', 'link') then 'Referral'\n   when lower(trim(mkt_source)) in ('email', 'e-mail', 'e_mail', 'e mail') or lower(trim(mkt_medium)) in ('email', 'e-mail', 'e_mail', 'e mail') then 'Email'\n   when lower(trim(mkt_medium)) = 'affiliate' then 'Affiliates'\n   when lower(trim(mkt_medium)) = 'audio' then 'Audio'\n   when lower(trim(mkt_source)) = 'sms' or lower(trim(mkt_medium)) = 'sms' then 'SMS'\n   when lower(trim(mkt_medium)) like '%push' or regexp_like(lower(trim(mkt_medium)), '.*(mobile|notification).*') or lower(trim(mkt_source)) = 'firebase' then 'Mobile Push Notifications'\n   else 'Unassigned'\nend\n as default_channel_group,\n\n        -- geo fields\n        geo_country as geo_country,\n        geo_region as geo_region,\n        geo_region_name as geo_region_name,\n        geo_city as geo_city,\n        geo_zipcode as geo_zipcode,\n        geo_latitude as geo_latitude,\n        geo_longitude as geo_longitude,\n        geo_timezone as geo_timezone,\n        g.name as geo_country_name,\n        g.region as geo_continent,\n\n        -- ip address\n        user_ipaddress as user_ipaddress,\n\n        -- user agent\n        useragent as useragent,\n\n        dvce_screenwidth || 'x' || dvce_screenheight as screen_resolution,\n\n        br_renderengine as br_renderengine,\n        br_lang as br_lang,\n        l.name as br_lang_name,\n        os_timezone as os_timezone,\n\n        -- optional fields, only populated if enabled.\n\n        -- iab enrichment fields\n        \n        contexts_com_iab_snowplow_spiders_and_robots_1[0]:category::VARCHAR as category,\n        contexts_com_iab_snowplow_spiders_and_robots_1[0]:primaryImpact::VARCHAR as primary_impact,\n        contexts_com_iab_snowplow_spiders_and_robots_1[0]:reason::VARCHAR as reason,\n        contexts_com_iab_snowplow_spiders_and_robots_1[0]:spiderOrRobot::BOOLEAN as spider_or_robot,\n\n        -- ua parser enrichment fields\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:useragentFamily::VARCHAR as useragent_family,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:useragentMajor::VARCHAR as useragent_major,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:useragentMinor::VARCHAR as useragent_minor,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:useragentPatch::VARCHAR as useragent_patch,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:useragentVersion::VARCHAR as useragent_version,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osFamily::VARCHAR as os_family,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osMajor::VARCHAR as os_major,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osMinor::VARCHAR as os_minor,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osPatch::VARCHAR as os_patch,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osPatchMinor::VARCHAR as os_patch_minor,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osVersion::VARCHAR as os_version,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:deviceFamily::VARCHAR as device_family\n\n,\n\n        -- yauaa enrichment fields\n        contexts_nl_basjes_yauaa_context_1[0]:deviceClass::VARCHAR as device_class,\n        contexts_nl_basjes_yauaa_context_1[0]:agentClass::VARCHAR as agent_class,\n        contexts_nl_basjes_yauaa_context_1[0]:agentName::VARCHAR as agent_name,\n        contexts_nl_basjes_yauaa_context_1[0]:agentNameVersion::VARCHAR as agent_name_version,\n        contexts_nl_basjes_yauaa_context_1[0]:agentNameVersionMajor::VARCHAR as agent_name_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:agentVersion::VARCHAR as agent_version,\n        contexts_nl_basjes_yauaa_context_1[0]:agentVersionMajor::VARCHAR as agent_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:deviceBrand::VARCHAR as device_brand,\n        contexts_nl_basjes_yauaa_context_1[0]:deviceName::VARCHAR as device_name,\n        contexts_nl_basjes_yauaa_context_1[0]:deviceVersion::VARCHAR as device_version,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineClass::VARCHAR as layout_engine_class,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineName::VARCHAR as layout_engine_name,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineNameVersion::VARCHAR as layout_engine_name_version,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineNameVersionMajor::VARCHAR as layout_engine_name_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineVersion::VARCHAR as layout_engine_version,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineVersionMajor::VARCHAR as layout_engine_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemClass::VARCHAR as operating_system_class,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemName::VARCHAR as operating_system_name,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemNameVersion::VARCHAR as operating_system_name_version,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemVersion::VARCHAR as operating_system_version,\n\n        -- event name for use later\n        event_name\n    from embucket.public_scratch.snowplow_web_base_events_this_run ev\n    left join\n        embucket.public_snowplow_manifest.snowplow_web_dim_ga4_source_categories c on lower(trim(ev.mkt_source)) = lower(c.source)\n    left join\n        embucket.public_snowplow_manifest.snowplow_web_dim_rfc_5646_language_mapping l on lower(ev.br_lang) = lower(l.lang_tag)\n    left join\n        embucket.public_snowplow_manifest.snowplow_web_dim_geo_country_mapping g on lower(ev.geo_country) = lower(g.alpha_2)\n    where\n        event_name in ('page_ping', 'page_view')\n        and page_view_id is not null\n        \n            \n  and not rlike(lower(useragent), '.*(bot|crawl|slurp|spider|archiv|spinn|sniff|seo|audit|survey|pingdom|worm|capture|(browser|screen)shots|analyz|index|thumb|check|facebook|pingdombot|phantomjs|yandexbot|twitterbot|a_archiver|facebookexternalhit|bingbot|bingpreview|googlebot|baiduspider|360(spider|user-agent)|semalt).*')\n\n        \n    qualify row_number() over (partition by domain_sessionid order by derived_tstamp, dvce_created_tstamp, event_id) = 1\n)\n\n, session_lasts as (\n    select\n        domain_sessionid,\n        page_title as last_page_title,\n        page_url as last_page_url,\n        page_urlscheme as last_page_urlscheme,\n        page_urlhost as last_page_urlhost,\n        page_urlpath as last_page_urlpath,\n        page_urlquery as last_page_urlquery,\n        page_urlfragment as last_page_urlfragment,\n        geo_country as last_geo_country,\n        geo_city as last_geo_city,\n        geo_region_name as last_geo_region_name,\n        g.name as last_geo_country_name,\n        g.region as last_geo_continent,\n        br_lang as last_br_lang,\n        l.name as last_br_lang_name\n    from embucket.public_scratch.snowplow_web_base_events_this_run ev\n    left join\n        embucket.public_snowplow_manifest.snowplow_web_dim_rfc_5646_language_mapping l on lower(ev.br_lang) = lower(l.lang_tag)\n    left join\n        embucket.public_snowplow_manifest.snowplow_web_dim_geo_country_mapping g on lower(ev.geo_country) = lower(g.alpha_2)\n    where\n        event_name = 'page_view'\n        and page_view_id is not null\n        \n            \n  and not rlike(lower(useragent), '.*(bot|crawl|slurp|spider|archiv|spinn|sniff|seo|audit|survey|pingdom|worm|capture|(browser|screen)shots|analyz|index|thumb|check|facebook|pingdombot|phantomjs|yandexbot|twitterbot|a_archiver|facebookexternalhit|bingbot|bingpreview|googlebot|baiduspider|360(spider|user-agent)|semalt).*')\n\n        \n    qualify row_number() over (partition by domain_sessionid order by derived_tstamp desc, dvce_created_tstamp desc, event_id) = 1\n)\n\n, session_aggs as (\n    select\n        domain_sessionid\n        , min(derived_tstamp) as start_tstamp\n        , max(derived_tstamp) as end_tstamp\n        , count(*) as total_events\n\n        -- engagement fields\n        , count(distinct case when event_name in ('page_ping', 'page_view') and page_view_id is not null then page_view_id else null end) as page_views\n            -- (hb * (#page pings - # distinct page view ids ON page pings)) + (# distinct page view ids ON page pings * min visit length)\n        , (10 * (\n                -- number of (unqiue in heartbeat increment) pages pings following a page ping (gap of heartbeat)\n                count(distinct case\n                        when event_name = 'page_ping' and page_view_id is not null then\n                        -- need to get a unique list of floored time PER page view, so create a dummy surrogate key...\n                            page_view_id || cast(floor(date_part('epoch_seconds', dvce_created_tstamp)/10) as TEXT)\n                        else\n                            null end) -\n                    count(distinct case when event_name = 'page_ping' and page_view_id is not null then page_view_id else null end)\n                ))  +\n            -- number of page pings following a page view (or no event) (gap of min visit length)\n            (count(distinct case when event_name = 'page_ping' and page_view_id is not null then page_view_id else null end) * 5) as engaged_time_in_s\n        , datediff(\n        second,\n        min(derived_tstamp),\n        max(derived_tstamp)\n        ) as absolute_time_in_s\n    from embucket.public_scratch.snowplow_web_base_events_this_run\n    where\n        1 = 1\n        \n            \n  and not rlike(lower(useragent), '.*(bot|crawl|slurp|spider|archiv|spinn|sniff|seo|audit|survey|pingdom|worm|capture|(browser|screen)shots|analyz|index|thumb|check|facebook|pingdombot|phantomjs|yandexbot|twitterbot|a_archiver|facebookexternalhit|bingbot|bingpreview|googlebot|baiduspider|360(spider|user-agent)|semalt).*')\n\n        \n    group by\n        domain_sessionid\n)\n\nselect\n    -- app id\n    a.app_id,\n\n    a.platform,\n\n    -- session fields\n    a.domain_sessionid,\n    a.original_domain_sessionid,\n    a.domain_sessionidx,\n\n    -- when the session starts with a ping we need to add the min visit length to get when the session actually started\n    case when a.event_name = 'page_ping' then\n        \n\n    dateadd(\n        second,\n        -5,\n        c.start_tstamp\n        )\n\n\n    else c.start_tstamp end as start_tstamp,\n    c.end_tstamp,\n    a.model_tstamp,\n\n    -- user fields\n    a.user_id,\n    a.domain_userid,\n    a.original_domain_userid,\n    a.stitched_user_id,\n    a.network_userid,\n\n    -- engagement fields\n    c.page_views,\n    c.engaged_time_in_s,\n    c.total_events,\n    \n    page_views >= 2 or engaged_time_in_s / 10 >= 2\n as is_engaged,\n    -- when the session starts with a ping we need to add the min visit length to get when the session actually started\n    c.absolute_time_in_s + case when a.event_name = 'page_ping' then 5 else 0 end as absolute_time_in_s,\n\n    -- first page fields\n    a.first_page_title,\n    a.first_page_url,\n    a.first_page_urlscheme,\n    a.first_page_urlhost,\n    a.first_page_urlpath,\n    a.first_page_urlquery,\n    a.first_page_urlfragment,\n\n    -- only take the first value when the last is genuinely missing (base on url as has to always be populated)\n    case when b.last_page_url is null then coalesce(b.last_page_title, a.first_page_title) else b.last_page_title end as last_page_title,\n    case when b.last_page_url is null then coalesce(b.last_page_url, a.first_page_url) else b.last_page_url end as last_page_url,\n    case when b.last_page_url is null then coalesce(b.last_page_urlscheme, a.first_page_urlscheme) else b.last_page_urlscheme end as last_page_urlscheme,\n    case when b.last_page_url is null then coalesce(b.last_page_urlhost, a.first_page_urlhost) else b.last_page_urlhost end as last_page_urlhost,\n    case when b.last_page_url is null then coalesce(b.last_page_urlpath, a.first_page_urlpath) else b.last_page_urlpath end as last_page_urlpath,\n    case when b.last_page_url is null then coalesce(b.last_page_urlquery, a.first_page_urlquery) else b.last_page_urlquery end as last_page_urlquery,\n    case when b.last_page_url is null then coalesce(b.last_page_urlfragment, a.first_page_urlfragment) else b.last_page_urlfragment end as last_page_urlfragment,\n\n    -- referrer fields\n    a.referrer,\n    a.refr_urlscheme,\n    a.refr_urlhost,\n    a.refr_urlpath,\n    a.refr_urlquery,\n    a.refr_urlfragment,\n    a.refr_medium,\n    a.refr_source,\n    a.refr_term,\n\n    -- marketing fields\n    a.mkt_medium,\n    a.mkt_source,\n    a.mkt_term,\n    a.mkt_content,\n    a.mkt_campaign,\n    a.mkt_clickid,\n    a.mkt_network,\n    a.mkt_source_platform,\n    a.default_channel_group,\n\n    -- geo fields\n    a.geo_country,\n    a.geo_region,\n    a.geo_region_name,\n    a.geo_city,\n    a.geo_zipcode,\n    a.geo_latitude,\n    a.geo_longitude,\n    a.geo_timezone,\n    a.geo_country_name,\n    a.geo_continent,\n    case when b.last_geo_country is null then coalesce(b.last_geo_country, a.geo_country) else b.last_geo_country end as last_geo_country,\n    case when b.last_geo_country is null then coalesce(b.last_geo_region_name, a.geo_region_name) else b.last_geo_region_name end as last_geo_region_name,\n    case when b.last_geo_country is null then coalesce(b.last_geo_city, a.geo_city) else b.last_geo_city end as last_geo_city,\n    case when b.last_geo_country is null then coalesce(b.last_geo_country_name,a.geo_country_name) else b.last_geo_country_name end as last_geo_country_name,\n    case when b.last_geo_country is null then coalesce(b.last_geo_continent, a.geo_continent) else b.last_geo_continent end as last_geo_continent,\n\n    -- ip address\n    a.user_ipaddress,\n\n    -- user agent\n    a.useragent,\n\n    a.br_renderengine,\n    a.br_lang,\n    a.br_lang_name,\n    case when b.last_br_lang is null then coalesce(b.last_br_lang, a.br_lang) else b.last_br_lang end as last_br_lang,\n    case when b.last_br_lang is null then coalesce(b.last_br_lang_name, a.br_lang_name) else b.last_br_lang_name end as last_br_lang_name,\n\n    a.os_timezone,\n\n    -- optional fields, only populated if enabled.\n\n    -- iab enrichment fields\n    a.category,\n    a.primary_impact,\n    a.reason,\n    a.spider_or_robot,\n\n    -- ua parser enrichment fields\n    a.useragent_family,\n    a.useragent_major,\n    a.useragent_minor,\n    a.useragent_patch,\n    a.useragent_version,\n    a.os_family,\n    a.os_major,\n    a.os_minor,\n    a.os_patch,\n    a.os_patch_minor,\n    a.os_version,\n    a.device_family,\n\n    -- yauaa enrichment fields\n    a.device_class,\n    case when a.device_class = 'Desktop' THEN 'Desktop'\n        when a.device_class = 'Phone' then 'Mobile'\n        when a.device_class = 'Tablet' then 'Tablet'\n        else 'Other' end as device_category,\n    a.screen_resolution,\n    a.agent_class,\n    a.agent_name,\n    a.agent_name_version,\n    a.agent_name_version_major,\n    a.agent_version,\n    a.agent_version_major,\n    a.device_brand,\n    a.device_name,\n    a.device_version,\n    a.layout_engine_class,\n    a.layout_engine_name,\n    a.layout_engine_name_version,\n    a.layout_engine_name_version_major,\n    a.layout_engine_version,\n    a.layout_engine_version_major,\n    a.operating_system_class,\n    a.operating_system_name,\n    a.operating_system_name_version,\n    a.operating_system_version\n\n    -- conversion fields\n\n    -- passthrough fields\nfrom\n    session_firsts a\nleft join\n    session_lasts b on a.domain_sessionid = b.domain_sessionid\nleft join\n    session_aggs c on a.domain_sessionid = c.domain_sessionid",
      "relation_name": "embucket.public_scratch.snowplow_web_sessions_this_run",
      "batch_results": null,
      "actual_row_count": 2825
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:37.743487Z",
          "completed_at": "2025-11-02T11:32:37.748589Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:37.748905Z",
          "completed_at": "2025-11-02T11:32:38.374796Z"
        }
      ],
      "thread_id": "Thread-4 (worker)",
      "execution_time": 0.632133960723877,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578096ade5"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_consent_versions",
      "compiled": true,
      "compiled_code": "\n\n\n\n\n\n\nwith consent_versions as (\n\n  select\n    consent_version,\n    consent_scopes,\n    consent_url,\n    domains_applied,\n    min(derived_tstamp) as version_start_tstamp,\n    max(load_tstamp) as last_allow_all_event\n\n  from embucket.public_derived.snowplow_web_consent_log\n\n  where event_name <> 'cmp_visible' and event_type = 'allow_all'\n\n  \n\n  group by 1,2,3,4\n)\n\n, latest_version as (\n\n  select\n    consent_version,\n    version_start_tstamp\n\n  from consent_versions\n\n  order by 2 desc limit 1\n)\n\n\n\nselect\n  v.consent_version,\n  v.version_start_tstamp,\n  v.consent_scopes,\n  v.consent_url,\n  v.domains_applied,\n  case when l.consent_version is not null then True else False end is_latest_version,\n  v.last_allow_all_event\n\nfrom consent_versions v\n\nleft join latest_version l\n\non v.consent_version = l.consent_version\n\n",
      "relation_name": "embucket.public_derived.snowplow_web_consent_versions",
      "batch_results": null,
      "actual_row_count": 0
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:37.726176Z",
          "completed_at": "2025-11-02T11:32:37.731888Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:37.732211Z",
          "completed_at": "2025-11-02T11:32:38.648008Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 0.9225459098815918,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578096d019"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_consent_cmp_stats",
      "compiled": true,
      "compiled_code": "\n\nwith events as (\n\n  select\n    event_id,\n    domain_userid,\n    original_domain_userid,\n    page_view_id,\n    domain_sessionid,\n    original_domain_sessionid,\n    derived_tstamp,\n    event_name,\n    event_type,\n    cmp_load_time,\n    last_value(case when event_name = 'cmp_visible' then event_id else null end ignore nulls)\n    over (partition by domain_userid order by derived_tstamp\n    rows between unbounded preceding and current row) as cmp_id\n\n  from embucket.public_derived.snowplow_web_consent_log\n\n  where event_type <> 'pending' or event_type is null\n\n), event_orders as (\n\n  select\n    event_id,\n    event_type,\n    cmp_id,\n    derived_tstamp,\n    row_number() over(partition by cmp_id order by derived_tstamp) as row_num\n\n  from events\n\n)\n\n, first_consent_events as (\n\n  select\n    event_id,\n    cmp_id,\n    event_type,\n    derived_tstamp as first_consent_event_tstamp\n\n  from event_orders\n\n  where row_num = 2\n\n)\n\n, cmp_events as (\n\n  select distinct\n    event_id,\n    domain_userid,\n    original_domain_userid,\n    page_view_id,\n    domain_sessionid,\n    original_domain_sessionid,\n    cmp_load_time,\n    derived_tstamp as cmp_tstamp\n\n  from events\n\n  where event_name = 'cmp_visible'\n\n)\n\nselect\n  e.event_id,\n  e.domain_userid,\n  e.original_domain_userid,\n  e.page_view_id,\n  e.domain_sessionid,\n  e.original_domain_sessionid,\n  e.cmp_load_time,\n  e.cmp_tstamp,\n  f.first_consent_event_tstamp,\n  f.event_type as first_consent_event_type,\n  datediff(\n        second,\n        e.cmp_tstamp,\n        f.first_consent_event_tstamp\n        ) as cmp_interaction_time\n\nfrom cmp_events e\n\nleft join first_consent_events f\non e.event_id = f.cmp_id",
      "relation_name": "embucket.public_derived.snowplow_web_consent_cmp_stats",
      "batch_results": null,
      "actual_row_count": 1406
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:38.071636Z",
          "completed_at": "2025-11-02T11:32:38.080151Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:38.080580Z",
          "completed_at": "2025-11-02T11:32:39.012901Z"
        }
      ],
      "thread_id": "Thread-1 (worker)",
      "execution_time": 0.9424488544464111,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578091a836"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_vitals_this_run",
      "compiled": true,
      "compiled_code": "\n\n\n\nwith prep as (\n\n  select\n    e.event_id,\n    e.event_name,\n    e.app_id,\n    e.platform,\n    e.domain_userid,\n    e.original_domain_userid,\n    e.user_id,\n    e.page_view_id,\n    e.domain_sessionid,\n    e.original_domain_sessionid,\n    e.collector_tstamp,\n    e.derived_tstamp,\n    e.load_tstamp,\n    coalesce(e.geo_country, 'unknown_geo_country') as geo_country,\n    coalesce(e.page_url, 'unknown_page_url') as page_url,\n    \n\n  case when page_url like '%/product%' then 'PDP'\n      when page_url like '%/list%' then 'PLP'\n      when page_url like '%/checkout%' then 'checkout'\n      when page_url like '%/home%' then 'homepage'\n      else 'other' end\n\n as url_group,\n    e.page_title,\n    e.useragent,\n    coalesce(e.device_class, 'unknown_device_class') as device_class,\n    e.device_name,\n    e.agent_name,\n    e.agent_version,\n    e.operating_system_name,\n    e.lcp,\n    e.fcp,\n    e.fid,\n    e.cls,\n    e.inp,\n    e.ttfb,\n    e.navigation_type,\n    row_number() over (partition by e.page_view_id order by e.derived_tstamp, e.dvce_created_tstamp, e.event_id) dedupe_index\n\n  from embucket.public_scratch.snowplow_web_vital_events_this_run as e\n\n  where True --returns false if run doesn't contain new events.\n\n\n)\n\nselect\n  *,\n  \n  case when lcp is null then 'not measurable'\n    when  lcp < 2.5 then 'good'\n    when lcp < 4 then 'needs improvement'\n    else 'poor' end as lcp_result,\n\n  case when fid is null then 'not measurable'\n    when fid < 100 then 'good'\n    when fid < 300 then 'needs improvement'\n    else 'poor' end as fid_result,\n\n  case when cls is null then 'not measurable'\n    when cls < 0.1 then 'good'\n    when cls < 0.25 then 'needs improvement'\n    else 'poor' end as cls_result,\n\n  case when ttfb is null then 'not measurable'\n    when ttfb < 800 then 'good'\n    when ttfb < 1800 then 'needs improvement'\n    else 'poor' end as ttfb_result,\n\n  case when inp is null then 'not measurable'\n    when inp < 200 then 'good'\n    when inp < 500 then 'needs improvement'\n    else 'poor' end as inp_result\n\n\n\nfrom prep p\n\nwhere dedupe_index = 1",
      "relation_name": "embucket.public_scratch.snowplow_web_vitals_this_run",
      "batch_results": null,
      "actual_row_count": 1427
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:37.553897Z",
          "completed_at": "2025-11-02T11:32:37.576026Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:37.576566Z",
          "completed_at": "2025-11-02T11:32:39.264105Z"
        }
      ],
      "thread_id": "Thread-3 (worker)",
      "execution_time": 1.7113139629364014,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780991093"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_page_views_this_run",
      "compiled": true,
      "compiled_code": "\n\n\n\nwith prep as (\nselect\n  ev.page_view_id,\n  ev.event_id,\n\n  ev.app_id,\n  ev.platform,\n\n  -- user fields\n  ev.user_id,\n  ev.domain_userid,\n  ev.original_domain_userid,\n  \n    cast(null as TEXT) as stitched_user_id,\n  \n  ev.network_userid,\n\n  -- session fields\n  ev.domain_sessionid,\n  ev.original_domain_sessionid,\n  ev.domain_sessionidx,\n\n  -- timestamp fields\n  ev.dvce_created_tstamp,\n  ev.collector_tstamp,\n  ev.derived_tstamp,\n  ev.derived_tstamp as start_tstamp,\n\n  ev.doc_width,\n  ev.doc_height,\n\n  ev.page_title,\n  \n  case when ev.page_url like '%/product%' then 'PDP'\n      when ev.page_url like '%/list%' then 'PLP'\n      when ev.page_url like '%/checkout%' then 'checkout'\n      when ev.page_url like '%/home%' then 'homepage'\n      else 'other'\n  end\n\n as content_group,\n  ev.page_url,\n  ev.page_urlscheme,\n  ev.page_urlhost,\n  ev.page_urlpath,\n  ev.page_urlquery,\n  ev.page_urlfragment,\n\n  -- marketing fields\n  ev.mkt_medium,\n  ev.mkt_source,\n  ev.mkt_term,\n  ev.mkt_content,\n  ev.mkt_campaign,\n  ev.mkt_clickid,\n  ev.mkt_network,\n  \ncase\n   when lower(trim(mkt_source)) = '(direct)' and lower(trim(mkt_medium)) in ('(not set)', '(none)') then 'Direct'\n   when lower(trim(mkt_medium)) like '%cross-network%' then 'Cross-network'\n   when regexp_like(lower(trim(mkt_medium)), '^(.*cp.*|ppc|retargeting|paid.*)$') then\n      case\n         when upper(source_category) = 'SOURCE_CATEGORY_SHOPPING'\n            or regexp_like(lower(trim(mkt_campaign)), '^(.*(([^a-df-z]|^)shop|shopping).*)$') then 'Paid Shopping'\n         when upper(source_category) = 'SOURCE_CATEGORY_SEARCH' then 'Paid Search'\n         when upper(source_category) = 'SOURCE_CATEGORY_SOCIAL' then 'Paid Social'\n         when upper(source_category) = 'SOURCE_CATEGORY_VIDEO' then 'Paid Video'\n         else 'Paid Other'\n      end\n   when lower(trim(mkt_medium)) in ('display', 'banner', 'expandable', 'intersitial', 'cpm') then 'Display'\n   when upper(source_category) = 'SOURCE_CATEGORY_SHOPPING'\n      or regexp_like(lower(trim(mkt_campaign)), '^(.*(([^a-df-z]|^)shop|shopping).*)$') then 'Organic Shopping'\n   when upper(source_category) = 'SOURCE_CATEGORY_SOCIAL' or lower(trim(mkt_medium)) in ('social', 'social-network', 'sm', 'social network', 'social media') then 'Organic Social'\n   when upper(source_category) = 'SOURCE_CATEGORY_VIDEO'\n      or regexp_like(lower(trim(mkt_medium)), '^(.*video.*)$') then 'Organic Video'\n   when upper(source_category) = 'SOURCE_CATEGORY_SEARCH' or lower(trim(mkt_medium)) = 'organic' then 'Organic Search'\n   when lower(trim(mkt_medium)) in ('referral', 'app', 'link') then 'Referral'\n   when lower(trim(mkt_source)) in ('email', 'e-mail', 'e_mail', 'e mail') or lower(trim(mkt_medium)) in ('email', 'e-mail', 'e_mail', 'e mail') then 'Email'\n   when lower(trim(mkt_medium)) = 'affiliate' then 'Affiliates'\n   when lower(trim(mkt_medium)) = 'audio' then 'Audio'\n   when lower(trim(mkt_source)) = 'sms' or lower(trim(mkt_medium)) = 'sms' then 'SMS'\n   when lower(trim(mkt_medium)) like '%push' or regexp_like(lower(trim(mkt_medium)), '.*(mobile|notification).*') or lower(trim(mkt_source)) = 'firebase' then 'Mobile Push Notifications'\n   else 'Unassigned'\nend\n as default_channel_group,\n\n  -- referrer fields\n  ev.page_referrer,\n  ev.refr_urlscheme,\n  ev.refr_urlhost,\n  ev.refr_urlpath,\n  ev.refr_urlquery,\n  ev.refr_urlfragment,\n  ev.refr_medium,\n  ev.refr_source,\n  ev.refr_term,\n\n  -- geo fields\n  ev.geo_country,\n  ev.geo_region,\n  ev.geo_region_name,\n  ev.geo_city,\n  ev.geo_zipcode,\n  ev.geo_latitude,\n  ev.geo_longitude,\n  ev.geo_timezone ,\n\n  ev.user_ipaddress,\n\n  ev.useragent,\n\n  ev.dvce_screenwidth || 'x' || ev.dvce_screenheight as screen_resolution,\n\n  ev.br_lang,\n  ev.br_viewwidth,\n  ev.br_viewheight,\n  ev.br_colordepth,\n  ev.br_renderengine,\n  ev.os_timezone,\n\n  -- optional fields, only populated if enabled.\n\n  -- iab enrichment fields: set iab variable to true to enable\n  \n        contexts_com_iab_snowplow_spiders_and_robots_1[0]:category::VARCHAR as category,\n        contexts_com_iab_snowplow_spiders_and_robots_1[0]:primaryImpact::VARCHAR as primary_impact,\n        contexts_com_iab_snowplow_spiders_and_robots_1[0]:reason::VARCHAR as reason,\n        contexts_com_iab_snowplow_spiders_and_robots_1[0]:spiderOrRobot::BOOLEAN as spider_or_robot,\n\n  -- ua parser enrichment fields\n  contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:useragentFamily::VARCHAR as useragent_family,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:useragentMajor::VARCHAR as useragent_major,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:useragentMinor::VARCHAR as useragent_minor,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:useragentPatch::VARCHAR as useragent_patch,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:useragentVersion::VARCHAR as useragent_version,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osFamily::VARCHAR as os_family,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osMajor::VARCHAR as os_major,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osMinor::VARCHAR as os_minor,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osPatch::VARCHAR as os_patch,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osPatchMinor::VARCHAR as os_patch_minor,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:osVersion::VARCHAR as os_version,\n        contexts_com_snowplowanalytics_snowplow_ua_parser_context_1[0]:deviceFamily::VARCHAR as device_family\n\n,\n\n  -- yauaa enrichment fields\n  contexts_nl_basjes_yauaa_context_1[0]:deviceClass::VARCHAR as device_class,\n        contexts_nl_basjes_yauaa_context_1[0]:agentClass::VARCHAR as agent_class,\n        contexts_nl_basjes_yauaa_context_1[0]:agentName::VARCHAR as agent_name,\n        contexts_nl_basjes_yauaa_context_1[0]:agentNameVersion::VARCHAR as agent_name_version,\n        contexts_nl_basjes_yauaa_context_1[0]:agentNameVersionMajor::VARCHAR as agent_name_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:agentVersion::VARCHAR as agent_version,\n        contexts_nl_basjes_yauaa_context_1[0]:agentVersionMajor::VARCHAR as agent_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:deviceBrand::VARCHAR as device_brand,\n        contexts_nl_basjes_yauaa_context_1[0]:deviceName::VARCHAR as device_name,\n        contexts_nl_basjes_yauaa_context_1[0]:deviceVersion::VARCHAR as device_version,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineClass::VARCHAR as layout_engine_class,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineName::VARCHAR as layout_engine_name,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineNameVersion::VARCHAR as layout_engine_name_version,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineNameVersionMajor::VARCHAR as layout_engine_name_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineVersion::VARCHAR as layout_engine_version,\n        contexts_nl_basjes_yauaa_context_1[0]:layoutEngineVersionMajor::VARCHAR as layout_engine_version_major,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemClass::VARCHAR as operating_system_class,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemName::VARCHAR as operating_system_name,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemNameVersion::VARCHAR as operating_system_name_version,\n        contexts_nl_basjes_yauaa_context_1[0]:operatingSystemVersion::VARCHAR as operating_system_version\n\n  from embucket.public_scratch.snowplow_web_base_events_this_run as ev\n\n  left join embucket.public_snowplow_manifest.snowplow_web_dim_ga4_source_categories c on lower(trim(ev.mkt_source)) = lower(c.source)\n\n  where ev.event_name = 'page_view'\n  and ev.page_view_id is not null\n\n  \n     \n  and not rlike(lower(ev.useragent), '.*(bot|crawl|slurp|spider|archiv|spinn|sniff|seo|audit|survey|pingdom|worm|capture|(browser|screen)shots|analyz|index|thumb|check|facebook|pingdombot|phantomjs|yandexbot|twitterbot|a_archiver|facebookexternalhit|bingbot|bingpreview|googlebot|baiduspider|360(spider|user-agent)|semalt).*')\n\n  \n\n  qualify row_number() over (partition by ev.page_view_id order by ev.derived_tstamp, ev.dvce_created_tstamp) = 1\n)\n\n, page_view_events as (\n  select\n    p.page_view_id,\n    p.event_id,\n\n    p.app_id,\n    p.platform,\n\n    -- user fields\n    p.user_id,\n    p.domain_userid,\n    p.original_domain_userid,\n    p.stitched_user_id,\n    p.network_userid,\n\n    -- session fields\n    p.domain_sessionid,\n    p.original_domain_sessionid,\n    p.domain_sessionidx,\n\n    row_number() over (partition by p.domain_sessionid order by p.derived_tstamp, p.dvce_created_tstamp, p.event_id) AS page_view_in_session_index,\n\n    -- timestamp fields\n    p.dvce_created_tstamp,\n    p.collector_tstamp,\n    p.derived_tstamp,\n    p.start_tstamp,\n    coalesce(t.end_tstamp, p.derived_tstamp) as end_tstamp, -- only page views with pings will have a row in table t\n    \n    convert_timezone('UTC', convert_timezone('UTC', current_timestamp()))::timestamp\n as model_tstamp,\n\n    coalesce(t.engaged_time_in_s, 0) as engaged_time_in_s, -- where there are no pings, engaged time is 0.\n    datediff(\n        second,\n        p.derived_tstamp,\n        coalesce(t.end_tstamp, p.derived_tstamp)\n        ) as absolute_time_in_s,\n\n    sd.hmax as horizontal_pixels_scrolled,\n    sd.vmax as vertical_pixels_scrolled,\n\n    sd.relative_hmax as horizontal_percentage_scrolled,\n    sd.relative_vmax as vertical_percentage_scrolled,\n\n    p.doc_width,\n    p.doc_height,\n\n    p.content_group,\n\n    p.page_title,\n    p.page_url,\n    p.page_urlscheme,\n    p.page_urlhost,\n    p.page_urlpath,\n    p.page_urlquery,\n    p.page_urlfragment,\n\n    p.mkt_medium,\n    p.mkt_source,\n    p.mkt_term,\n    p.mkt_content,\n    p.mkt_campaign,\n    p.mkt_clickid,\n    p.mkt_network,\n    p.default_channel_group,\n\n    p.page_referrer,\n    p.refr_urlscheme,\n    p.refr_urlhost,\n    p.refr_urlpath,\n    p.refr_urlquery,\n    p.refr_urlfragment,\n    p.refr_medium,\n    p.refr_source,\n    p.refr_term,\n\n    p.geo_country,\n    p.geo_region,\n    p.geo_region_name,\n    p.geo_city,\n    p.geo_zipcode,\n    p.geo_latitude,\n    p.geo_longitude,\n    p.geo_timezone,\n\n    p.user_ipaddress,\n\n    p.useragent,\n\n    p.screen_resolution,\n\n    p.br_lang,\n    p.br_viewwidth,\n    p.br_viewheight,\n    p.br_colordepth,\n    p.br_renderengine,\n\n    p.os_timezone,\n\n    p.category,\n    p.primary_impact,\n    p.reason,\n    p.spider_or_robot,\n\n    p.useragent_family,\n    p.useragent_major,\n    p.useragent_minor,\n    p.useragent_patch,\n    p.useragent_version,\n    p.os_family,\n    p.os_major,\n    p.os_minor,\n    p.os_patch,\n    p.os_patch_minor,\n    p.os_version,\n    p.device_family,\n\n    p.device_class,\n    p.agent_class,\n    p.agent_name,\n    p.agent_name_version,\n    p.agent_name_version_major,\n    p.agent_version,\n    p.agent_version_major,\n    p.device_brand,\n    p.device_name,\n    p.device_version,\n    p.layout_engine_class,\n    p.layout_engine_name,\n    p.layout_engine_name_version,\n    p.layout_engine_name_version_major,\n    p.layout_engine_version,\n    p.layout_engine_version_major,\n    p.operating_system_class,\n    p.operating_system_name,\n    p.operating_system_name_version,\n    p.operating_system_version\n\n  from prep p\n\n  left join embucket.public_scratch.snowplow_web_pv_engaged_time t\n  on p.page_view_id = t.page_view_id  and p.domain_sessionid = t.domain_sessionid \n\n  left join embucket.public_scratch.snowplow_web_pv_scroll_depth sd\n  on p.page_view_id = sd.page_view_id  and p.domain_sessionid = sd.domain_sessionid \n)\n\nselect\n  pve.page_view_id,\n  pve.event_id,\n\n  pve.app_id,\n  pve.platform,\n\n  -- user fields\n  pve.user_id,\n  pve.domain_userid,\n  pve.original_domain_userid,\n  pve.stitched_user_id,\n  pve.network_userid,\n\n  -- session fields\n  pve.domain_sessionid,\n  pve.original_domain_sessionid,\n  pve.domain_sessionidx,\n\n  pve.page_view_in_session_index,\n  max(pve.page_view_in_session_index) over (partition by pve.domain_sessionid) as page_views_in_session,\n\n  -- timestamp fields\n  pve.dvce_created_tstamp,\n  pve.collector_tstamp,\n  pve.derived_tstamp,\n  pve.start_tstamp,\n  pve.end_tstamp,\n  pve.model_tstamp,\n\n  pve.engaged_time_in_s,\n  pve.absolute_time_in_s,\n\n  pve.horizontal_pixels_scrolled,\n  pve.vertical_pixels_scrolled,\n\n  pve.horizontal_percentage_scrolled,\n  pve.vertical_percentage_scrolled,\n\n  pve.doc_width,\n  pve.doc_height,\n  pve.content_group,\n\n  pve.page_title,\n  pve.page_url,\n  pve.page_urlscheme,\n  pve.page_urlhost,\n  pve.page_urlpath,\n  pve.page_urlquery,\n  pve.page_urlfragment,\n\n  pve.mkt_medium,\n  pve.mkt_source,\n  pve.mkt_term,\n  pve.mkt_content,\n  pve.mkt_campaign,\n  pve.mkt_clickid,\n  pve.mkt_network,\n  pve.default_channel_group,\n\n  pve.page_referrer,\n  pve.refr_urlscheme,\n  pve.refr_urlhost,\n  pve.refr_urlpath,\n  pve.refr_urlquery,\n  pve.refr_urlfragment,\n  pve.refr_medium,\n  pve.refr_source,\n  pve.refr_term,\n\n  pve.geo_country,\n  pve.geo_region,\n  pve.geo_region_name,\n  pve.geo_city,\n  pve.geo_zipcode,\n  pve.geo_latitude,\n  pve.geo_longitude,\n  pve.geo_timezone,\n\n  pve.user_ipaddress,\n\n  pve.useragent,\n\n  pve.br_lang,\n  pve.br_viewwidth,\n  pve.br_viewheight,\n  pve.br_colordepth,\n  pve.br_renderengine,\n\n  pve.os_timezone,\n\n  pve.category,\n  pve.primary_impact,\n  pve.reason,\n  pve.spider_or_robot,\n\n  pve.useragent_family,\n  pve.useragent_major,\n  pve.useragent_minor,\n  pve.useragent_patch,\n  pve.useragent_version,\n  pve.os_family,\n  pve.os_major,\n  pve.os_minor,\n  pve.os_patch,\n  pve.os_patch_minor,\n  pve.os_version,\n  pve.device_family,\n\n  pve.device_class,\n  case when pve.device_class = 'Desktop' then 'Desktop'\n    when pve.device_class = 'Phone' then 'Mobile'\n    when pve.device_class = 'Tablet' then 'Tablet'\n    else 'Other' end as device_category,\n  pve.screen_resolution,\n  pve.agent_class,\n  pve.agent_name,\n  pve.agent_name_version,\n  pve.agent_name_version_major,\n  pve.agent_version,\n  pve.agent_version_major,\n  pve.device_brand,\n  pve.device_name,\n  pve.device_version,\n  pve.layout_engine_class,\n  pve.layout_engine_name,\n  pve.layout_engine_name_version,\n  pve.layout_engine_name_version_major,\n  pve.layout_engine_version,\n  pve.layout_engine_version_major,\n  pve.operating_system_class,\n  pve.operating_system_name,\n  pve.operating_system_name_version,\n  pve.operating_system_version\n\nfrom page_view_events pve",
      "relation_name": "embucket.public_scratch.snowplow_web_page_views_this_run",
      "batch_results": null,
      "actual_row_count": 1440
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:38.651549Z",
          "completed_at": "2025-11-02T11:32:38.662586Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:38.662996Z",
          "completed_at": "2025-11-02T11:32:39.659646Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 1.0089879035949707,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578088b7bd"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_consent_users",
      "compiled": true,
      "compiled_code": "\n\n\n\n\n\n\nwith base as (\n\n  select\n    domain_userid,\n    user_id,\n    geo_country,\n    max(load_tstamp) as last_processed_event,\n    count(case when event_name = 'cmp_visible' then 1 end) as cmp_events,\n    count(case when event_name = 'consent_preferences' then 1 end) as consent_events,\n    max(case when event_name = 'cmp_visible' then derived_tstamp end) as last_cmp_event_tstamp,\n    row_number() over(partition by domain_userid order by max(load_tstamp) desc) as latest_event_by_user_rank\n\n  from embucket.public_derived.snowplow_web_consent_log\n\n  \n\n  group by 1,2,3\n\n)\n\n, latest_consents as (\n\n  select\n    domain_userid,\n    derived_tstamp as last_consent_event_tstamp,\n    event_type as last_consent_event_type,\n    consent_scopes as last_consent_scopes,\n    consent_version as last_consent_version,\n    consent_url as last_consent_url,\n    domains_applied as last_domains_applied,\n    row_number() over(partition by domain_userid order by load_tstamp desc) as latest_consent_event_by_user_rank\n\n  from embucket.public_derived.snowplow_web_consent_log\n\n  where event_name = 'consent_preferences'\n\n  \n\n)\n\n\n\nselect\n  b.domain_userid,\n  b.user_id,\n  b.geo_country,\n  b.cmp_events,\n  b.consent_events,\n  b.last_cmp_event_tstamp,\n  l.last_consent_event_tstamp,\n  l.last_consent_event_type,\n  l.last_consent_scopes,\n  l.last_consent_version,\n  l.last_consent_url,\n  l.last_domains_applied,\n  b.last_processed_event,\n  case when v.is_latest_version then True else False end as is_latest_version\n\nfrom base b\n\nleft join latest_consents l\non b.domain_userid = l.domain_userid\n\nleft join embucket.public_derived.snowplow_web_consent_versions v\non v.consent_version = l.last_consent_version\n\nwhere (l.latest_consent_event_by_user_rank = 1 or l.domain_userid is null)\nand b.latest_event_by_user_rank = 1\n\n",
      "relation_name": "embucket.public_derived.snowplow_web_consent_users",
      "batch_results": null,
      "actual_row_count": 2846
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:38.379230Z",
          "completed_at": "2025-11-02T11:32:38.389404Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:38.389842Z",
          "completed_at": "2025-11-02T11:32:39.736863Z"
        }
      ],
      "thread_id": "Thread-4 (worker)",
      "execution_time": 1.3586962223052979,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578081b477"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_sessions",
      "compiled": true,
      "compiled_code": "\n\n\n\n\nselect *\n  \nfrom embucket.public_scratch.snowplow_web_sessions_this_run\nwhere True --returns false if run doesn't contain new events.",
      "relation_name": "embucket.public_derived.snowplow_web_sessions",
      "batch_results": null,
      "actual_row_count": 2825
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:39.664496Z",
          "completed_at": "2025-11-02T11:32:39.671830Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:39.672248Z",
          "completed_at": "2025-11-02T11:32:39.994682Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 0.3312211036682129,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-4457807b9410"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_consent_scope_status",
      "compiled": true,
      "compiled_code": "\n\n\n\nwith arrays as (\n\n  select\n    u.domain_userid,\n    \n    split(u.last_consent_scopes, ', ')\n as scope_array\n\n  from embucket.public_derived.snowplow_web_consent_users u\n\n  where is_latest_version\n\n  )\n\n  , unnesting as (\n\n    \n    select t.domain_userid, replace(r.value, '\"', '') as consent_scope\n    from arrays t, table(flatten(t.scope_array)) r\n\n\n  )\n\nselect\n  replace(replace(replace(cast(consent_scope as \n    TEXT\n), '\"', ''), '[', ''), ']', '') as scope,\n  count(*) as total_consent\n\nfrom unnesting\n\ngroup by 1",
      "relation_name": "embucket.public_derived.snowplow_web_consent_scope_status",
      "batch_results": null,
      "actual_row_count": 0
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:39.018957Z",
          "completed_at": "2025-11-02T11:32:39.029552Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:39.029910Z",
          "completed_at": "2025-11-02T11:32:40.156683Z"
        }
      ],
      "thread_id": "Thread-1 (worker)",
      "execution_time": 1.1387500762939453,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578079092e"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_vitals",
      "compiled": true,
      "compiled_code": "\n\n\n\nselect\n  *\n  \n\nfrom embucket.public_scratch.snowplow_web_vitals_this_run\n\nwhere True --returns false if run doesn't contain new events.",
      "relation_name": "embucket.public_derived.snowplow_web_vitals",
      "batch_results": null,
      "actual_row_count": 1427
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:39.271187Z",
          "completed_at": "2025-11-02T11:32:39.279413Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:39.279798Z",
          "completed_at": "2025-11-02T11:32:40.403754Z"
        }
      ],
      "thread_id": "Thread-3 (worker)",
      "execution_time": 1.1334741115570068,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578074f9d1"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_page_views",
      "compiled": true,
      "compiled_code": "\n\n\n\n\nselect *\n  \nfrom embucket.public_scratch.snowplow_web_page_views_this_run\nwhere True --returns false if run doesn't contain new events.",
      "relation_name": "embucket.public_derived.snowplow_web_page_views",
      "batch_results": null,
      "actual_row_count": 1440
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:40.158502Z",
          "completed_at": "2025-11-02T11:32:40.168397Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:40.168730Z",
          "completed_at": "2025-11-02T11:32:40.832073Z"
        }
      ],
      "thread_id": "Thread-1 (worker)",
      "execution_time": 0.6741073131561279,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578071b801"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_vital_measurements",
      "compiled": true,
      "compiled_code": "\n\n\n\nwith measurements as (\n\n  select\n    page_url,\n    device_class,\n    geo_country,\n    cast( date_trunc('day', derived_tstamp) as TEXT) as time_period,\n    count(*) as page_view_count,\n    grouping_id(page_url, device_class) as id_url_and_device,\n    grouping_id(device_class) as id_device,\n    grouping_id(cast( date_trunc('day', derived_tstamp) as TEXT)) as id_period,\n    grouping_id(cast( date_trunc('day', derived_tstamp) as TEXT), device_class) as id_period_and_device,\n    grouping_id(geo_country) as id_country,\n    grouping_id(geo_country, device_class) as id_country_and_device,\n    percentile_cont(0.75) within group (order by lcp) as lcp_75p,\n    percentile_cont(0.75) within group (order by fid) as fid_75p,\n    percentile_cont(0.75) within group (order by cls) as cls_75p,\n    percentile_cont(0.75) within group (order by ttfb) as ttfb_75p,\n    percentile_cont(0.75) within group (order by inp) as inp_75p\n\n  from embucket.public_derived.snowplow_web_vitals\n\n  where cast(derived_tstamp as date) >= \n\n    dateadd(\n        day,\n        -999,\n        date_trunc('day', \n    convert_timezone('UTC', convert_timezone('UTC', current_timestamp()))::timestamp\n)\n        )\n\n\n\n  group by grouping sets ((), (page_url, device_class), (device_class), (cast( date_trunc('day', derived_tstamp) as TEXT)), (cast( date_trunc('day', derived_tstamp) as TEXT), device_class), (geo_country), (geo_country, device_class))\n\n)\n\n, measurement_type as (\n\n  select\n    *,\n    case when id_url_and_device <> 0 and id_device <> 0 and id_period <> 0 and id_period_and_device <> 0 and id_country <> 0 and id_country_and_device <> 0 then 'overall'\n       when id_url_and_device = 0 then 'by_url_and_device'\n       when id_period_and_device = 0 then 'by_day_and_device'\n       when id_country_and_device = 0 then 'by_country_and_device'\n       when id_country = 0 then 'by_country'\n       when id_device = 0 then 'by_device'\n       when id_period = 0 then 'by_day'\n       end as measurement_type,\n   \n  case when lcp_75p is null then 'not measurable'\n    when  lcp_75p < 2.5 then 'good'\n    when lcp_75p < 4 then 'needs improvement'\n    else 'poor' end as lcp_result,\n\n  case when fid_75p is null then 'not measurable'\n    when fid_75p < 100 then 'good'\n    when fid_75p < 300 then 'needs improvement'\n    else 'poor' end as fid_result,\n\n  case when cls_75p is null then 'not measurable'\n    when cls_75p < 0.1 then 'good'\n    when cls_75p < 0.25 then 'needs improvement'\n    else 'poor' end as cls_result,\n\n  case when ttfb_75p is null then 'not measurable'\n    when ttfb_75p < 800 then 'good'\n    when ttfb_75p < 1800 then 'needs improvement'\n    else 'poor' end as ttfb_result,\n\n  case when inp_75p is null then 'not measurable'\n    when inp_75p < 200 then 'good'\n    when inp_75p < 500 then 'needs improvement'\n    else 'poor' end as inp_result\n\n\n\n  from measurements\n)\n\n, coalesce as (\n\n  select\n    m.measurement_type,\n    coalesce(m.page_url, 'all') as page_url,\n    coalesce(m.device_class, 'all') as device_class,\n    coalesce(m.geo_country, 'all') as geo_country,\n    coalesce(g.name, 'all') as country,\n    coalesce(time_period, 'last 999 days') as time_period,\n    page_view_count,\n    ceil(lcp_75p, 3) as lcp_75p,\n    ceil(fid_75p, 3) as fid_75p,\n    ceil(cls_75p, 3) as cls_75p,\n    ceil(ttfb_75p, 3) as ttfb_75p,\n    ceil(inp_75p, 3) as inp_75p,\n    m.lcp_result,\n    m.fid_result,\n    m.cls_result,\n    m.ttfb_result,\n    m.inp_result,\n    \n\ncase when m.lcp_result = 'good' and m.fid_result = 'good' and m.cls_result = 'good' then 1 else 0 end\n\n as passed\n\n  from measurement_type m\n\n  left join embucket.public_snowplow_manifest.snowplow_web_dim_geo_country_mapping g on lower(m.geo_country) = lower(g.alpha_2)\n\n  order by 1\n\n)\n\nselect\n  page_url || '-' || device_class || '-' || geo_country || '-' || time_period compound_key,\n  *\nfrom coalesce",
      "relation_name": "embucket.public_derived.snowplow_web_vital_measurements",
      "batch_results": null,
      "actual_row_count": 0
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:40.006597Z",
          "completed_at": "2025-11-02T11:32:40.013526Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:40.014139Z",
          "completed_at": "2025-11-02T11:32:40.921807Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 0.916693925857544,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780741837"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_users_sessions_this_run",
      "compiled": true,
      "compiled_code": "\n\n\n\nselect\n  a.*,\n  min(a.start_tstamp) over(partition by a.domain_userid) as user_start_tstamp,\n  max(a.end_tstamp) over(partition by a.domain_userid) as user_end_tstamp\n\nfrom embucket.public_derived.snowplow_web_sessions a\nwhere exists (select 1 from embucket.public_scratch.snowplow_web_base_sessions_this_run b where a.domain_userid = b.user_identifier)",
      "relation_name": "embucket.public_scratch.snowplow_web_users_sessions_this_run",
      "batch_results": null,
      "actual_row_count": 2825
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:39.739020Z",
          "completed_at": "2025-11-02T11:32:39.742829Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:39.743066Z",
          "completed_at": "2025-11-02T11:32:40.246382Z"
        }
      ],
      "thread_id": "Thread-4 (worker)",
      "execution_time": 0.5078749656677246,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-445780784a98"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_consent_totals",
      "compiled": true,
      "compiled_code": "\n\n\n\nwith totals as (\n\n  select\n    last_consent_version,\n    count(distinct domain_userid) as total_visitors,\n    count(case when last_consent_event_type ='allow_all' then 1 end) as allow_all,\n    count(case when last_consent_event_type ='allow_selected' then 1 end) as allow_selected,\n    count(case when last_consent_event_type IN ('allow_all', 'allow_selected') then 1 end) as allow,\n    count(case when last_consent_event_type = 'pending' then 1 end) as pending,\n    count(case when last_consent_event_type = 'deny_all'  then 1 end) as denied,\n    count(case when last_consent_event_type = 'expired'  then 1 end) as expired,\n    count(case when last_consent_event_type = 'withdrawn'  then 1 end) as withdrawn,\n    count(case when last_consent_event_type = 'implicit_consent'  then 1 end) as implicit_consent,\n    count(case when \n\n    dateadd(\n        year,\n        1,\n        last_consent_event_tstamp\n        )\n\n <= \n\n    dateadd(\n        month,\n        6,\n        current_date\n        )\n\n\n          and last_consent_event_type <> 'expired'\n          and \n\n    dateadd(\n        year,\n        1,\n        last_consent_event_tstamp\n        )\n\n > current_date then 1 end) as expires_in_six_months\n\n  from embucket.public_derived.snowplow_web_consent_users\n\n  where last_consent_event_type is not null\n\n  group by 1\n\n)\n\nselect\n  v.*,\n  t.total_visitors,\n  t.allow_all,\n  t.allow_selected,\n  t.allow,\n  t.pending,\n  t.denied,\n  t.expired,\n  t.withdrawn,\n  t.implicit_consent,\n  t.expires_in_six_months\n\nfrom embucket.public_derived.snowplow_web_consent_versions v\n\nleft join totals t\non t.last_consent_version = v.consent_version\n\norder by v.version_start_tstamp desc",
      "relation_name": "embucket.public_derived.snowplow_web_consent_totals",
      "batch_results": null,
      "actual_row_count": 0
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:41.020969Z",
          "completed_at": "2025-11-02T11:32:41.025288Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:41.025670Z",
          "completed_at": "2025-11-02T11:32:41.860674Z"
        }
      ],
      "thread_id": "Thread-3 (worker)",
      "execution_time": 0.8402490615844727,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578064b419"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_users_aggs",
      "compiled": true,
      "compiled_code": "\n\n\n\nselect\n  domain_userid,\n  -- time\n  user_start_tstamp as start_tstamp,\n  user_end_tstamp as end_tstamp,\n  -- first/last session. Max to resolve edge case with multiple sessions with the same start/end tstamp\n  max(case when start_tstamp = user_start_tstamp then domain_sessionid end) as first_domain_sessionid,\n  max(case when end_tstamp = user_end_tstamp then domain_sessionid end) as last_domain_sessionid,\n  -- engagement\n  sum(page_views) as page_views,\n  count(distinct domain_sessionid) as sessions,\n  sum(engaged_time_in_s) as engaged_time_in_s\n\nfrom embucket.public_scratch.snowplow_web_users_sessions_this_run\n\ngroup by 1,2,3",
      "relation_name": "embucket.public_scratch.snowplow_web_users_aggs",
      "batch_results": null,
      "actual_row_count": 2825
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:41.863277Z",
          "completed_at": "2025-11-02T11:32:41.868680Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:41.868922Z",
          "completed_at": "2025-11-02T11:32:42.630827Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 0.7684390544891357,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578057f1b4"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_users_lasts",
      "compiled": true,
      "compiled_code": "\n\n\n\n\nselect\n  a.domain_userid,\n  a.last_page_title,\n\n  a.last_page_url,\n\n  a.last_page_urlscheme,\n  a.last_page_urlhost,\n  a.last_page_urlpath,\n  a.last_page_urlquery,\n  a.last_page_urlfragment,\n\n  a.last_geo_country,\n  a.last_geo_country_name,\n  a.last_geo_continent,\n  a.last_geo_city,\n  a.last_geo_region_name,\n  a.last_br_lang,\n  a.last_br_lang_name\n\nfrom embucket.public_scratch.snowplow_web_users_sessions_this_run a\n\ninner join embucket.public_scratch.snowplow_web_users_aggs b\non a.domain_sessionid = b.last_domain_sessionid",
      "relation_name": "embucket.public_scratch.snowplow_web_users_lasts",
      "batch_results": null,
      "actual_row_count": 2825
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:42.636911Z",
          "completed_at": "2025-11-02T11:32:42.648483Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:42.648862Z",
          "completed_at": "2025-11-02T11:32:43.508830Z"
        }
      ],
      "thread_id": "Thread-1 (worker)",
      "execution_time": 0.873053789138794,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-4457804bf8ec"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_users_this_run",
      "compiled": true,
      "compiled_code": "\n\n\n\nselect\n  -- user fields\n  a.user_id,\n  a.domain_userid,\n  a.original_domain_userid,\n  a.network_userid,\n\n  b.start_tstamp,\n  b.end_tstamp,\n  \n    convert_timezone('UTC', convert_timezone('UTC', current_timestamp()))::timestamp\n as model_tstamp,\n\n  -- engagement fields\n  b.page_views,\n  b.sessions,\n\n  b.engaged_time_in_s,\n\n  -- first page fields\n  a.first_page_title,\n  a.first_page_url,\n  a.first_page_urlscheme,\n  a.first_page_urlhost,\n  a.first_page_urlpath,\n  a.first_page_urlquery,\n  a.first_page_urlfragment,\n\n  a.geo_country as first_geo_country,\n  a.geo_country_name as first_geo_country_name,\n  a.geo_continent as first_geo_continent,\n  a.geo_city as first_geo_city,\n  a.geo_region_name as first_geo_region_name,\n  a.br_lang as first_br_lang,\n  a.br_lang_name as first_br_lang_name,\n\n  c.last_page_title,\n  c.last_page_url,\n  c.last_page_urlscheme,\n  c.last_page_urlhost,\n  c.last_page_urlpath,\n  c.last_page_urlquery,\n  c.last_page_urlfragment,\n\n  c.last_geo_country,\n  c.last_geo_country_name,\n  c.last_geo_continent,\n  c.last_geo_city,\n  c.last_geo_region_name,\n  c.last_br_lang,\n  c.last_br_lang_name,\n\n\n  -- referrer fields\n  a.referrer,\n\n  a.refr_urlscheme,\n  a.refr_urlhost,\n  a.refr_urlpath,\n  a.refr_urlquery,\n  a.refr_urlfragment,\n\n  a.refr_medium,\n  a.refr_source,\n  a.refr_term,\n\n  -- marketing fields\n  a.mkt_medium,\n  a.mkt_source,\n  a.mkt_term,\n  a.mkt_content,\n  a.mkt_campaign,\n  a.mkt_clickid,\n  a.mkt_network,\n  a.mkt_source_platform,\n  a.default_channel_group\n\nfrom embucket.public_scratch.snowplow_web_users_aggs as b\n\ninner join embucket.public_scratch.snowplow_web_users_sessions_this_run as a\non a.domain_sessionid = b.first_domain_sessionid\n\ninner join embucket.public_scratch.snowplow_web_users_lasts c\non b.domain_userid = c.domain_userid",
      "relation_name": "embucket.public_scratch.snowplow_web_users_this_run",
      "batch_results": null,
      "actual_row_count": 2825
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:43.512511Z",
          "completed_at": "2025-11-02T11:32:43.518753Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:43.519056Z",
          "completed_at": "2025-11-02T11:32:44.621960Z"
        }
      ],
      "thread_id": "Thread-4 (worker)",
      "execution_time": 1.110206127166748,
      "adapter_response": {
        "_message": "02000 1",
        "code": "02000",
        "rows_affected": 1,
        "query_id": "00000000-0000-0000-001d-44578034c2af"
      },
      "message": "02000 1",
      "failures": null,
      "unique_id": "model.snowplow_web.snowplow_web_users",
      "compiled": true,
      "compiled_code": "\n\n\n\nselect *\n  \nfrom embucket.public_scratch.snowplow_web_users_this_run\nwhere True --returns false if run doesn't contain new events.",
      "relation_name": "embucket.public_derived.snowplow_web_users",
      "batch_results": null,
      "actual_row_count": 2825
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2025-11-02T11:32:44.626400Z",
          "completed_at": "2025-11-02T11:32:44.633498Z"
        },
        {
          "name": "execute",
          "started_at": "2025-11-02T11:32:44.633975Z",
          "completed_at": "2025-11-02T11:32:47.647259Z"
        }
      ],
      "thread_id": "main",
      "execution_time": 3.020859,
      "adapter_response": {},
      "message": "snowplow_web.on-run-end.0 passed",
      "failures": 0,
      "unique_id": "operation.snowplow_web.snowplow_web-on-run-end-0",
      "compiled": true,
      "compiled_code": "\n\n  \n\n    \n\n    merge into embucket.public_snowplow_manifest.snowplow_web_incremental_manifest m\n    using ( \n      select\n        b.model,\n        a.last_success\n\n      from\n        (select max(collector_tstamp) as last_success from embucket.public_scratch.snowplow_web_base_events_this_run) a,\n        ( select 'snowplow_web_pv_engaged_time' as model union all   select 'snowplow_web_consent_events_this_run' as model union all   select 'snowplow_web_pv_scroll_depth' as model union all   select 'snowplow_web_user_mapping' as model union all   select 'snowplow_web_consent_log' as model union all   select 'snowplow_web_vital_events_this_run' as model union all   select 'snowplow_web_sessions_this_run' as model union all   select 'snowplow_web_consent_versions' as model union all   select 'snowplow_web_consent_cmp_stats' as model union all   select 'snowplow_web_vitals_this_run' as model union all   select 'snowplow_web_page_views_this_run' as model union all   select 'snowplow_web_consent_users' as model union all   select 'snowplow_web_sessions' as model union all   select 'snowplow_web_consent_scope_status' as model union all   select 'snowplow_web_vitals' as model union all   select 'snowplow_web_page_views' as model union all   select 'snowplow_web_vital_measurements' as model union all   select 'snowplow_web_users_sessions_this_run' as model union all   select 'snowplow_web_consent_totals' as model union all   select 'snowplow_web_users_aggs' as model union all   select 'snowplow_web_users_lasts' as model union all   select 'snowplow_web_users_this_run' as model union all   select 'snowplow_web_users' as model ) b\n\n      where a.last_success is not null -- if run contains no data don't add to manifest\n     ) s\n    on m.model = s.model\n    when matched then\n        update set last_success = greatest(m.last_success, s.last_success)\n    when not matched then\n        insert (model, last_success) values(model, last_success);\n\n    \n      commit;\n    \n\n  \n\n",
      "relation_name": null,
      "batch_results": null
    }
  ],
  "elapsed_time": 19.921959161758423,
  "args": {
    "require_explicit_package_overrides_for_builtin_materializations": true,
    "target": "embucket",
    "invocation_command": "dbt run --target embucket --full-refresh --vars {snowplow__enable_consent: true, snowplow__enable_cwv: true, snowplow__enable_iab: true, snowplow__enable_ua: true, snowplow__enable_yauaa: true, snowplow__start_date: 2025-09-01, snowplow__backfill_limit_days: 50, snowplow__cwv_days_to_measure: 999}",
    "require_nested_cumulative_type_params": false,
    "use_colors_file": true,
    "partial_parse": true,
    "empty": false,
    "profiles_dir": "/Users/oleksandrmazur/repos/benchmarks/dbt-snowplow-web/embucket/dbt-snowplow-web",
    "skip_nodes_if_on_run_start_fails": false,
    "defer": false,
    "require_resource_names_without_spaces": false,
    "introspect": true,
    "populate_cache": true,
    "warn_error_options": {
      "include": [],
      "exclude": []
    },
    "favor_state": false,
    "exclude": [],
    "select": [],
    "source_freshness_run_project_hooks": false,
    "write_json": true,
    "version_check": true,
    "log_format": "default",
    "show_resource_report": false,
    "cache_selected_only": false,
    "full_refresh": true,
    "static_parser": true,
    "log_level": "info",
    "print": true,
    "partial_parse_file_diff": true,
    "vars": {
      "snowplow__enable_consent": true,
      "snowplow__enable_cwv": true,
      "snowplow__enable_iab": true,
      "snowplow__enable_ua": true,
      "snowplow__enable_yauaa": true,
      "snowplow__start_date": "2025-09-01",
      "snowplow__backfill_limit_days": 50,
      "snowplow__cwv_days_to_measure": 999
    },
    "indirect_selection": "eager",
    "printer_width": 80,
    "project_dir": "/Users/oleksandrmazur/repos/benchmarks/dbt-snowplow-web/embucket/dbt-snowplow-web",
    "quiet": false,
    "require_yaml_configuration_for_mf_time_spines": false,
    "send_anonymous_usage_stats": true,
    "which": "run",
    "macro_debugging": false,
    "state_modified_compare_vars": false,
    "strict_mode": false,
    "log_level_file": "debug",
    "use_colors": true,
    "log_format_file": "debug",
    "state_modified_compare_more_unrendered_values": false,
    "log_file_max_bytes": 10485760,
    "log_path": "/Users/oleksandrmazur/repos/benchmarks/dbt-snowplow-web/embucket/dbt-snowplow-web/logs",
    "require_batched_execution_for_custom_microbatch_strategy": false
  }
}